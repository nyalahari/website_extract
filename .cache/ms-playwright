# snippet: cache playwright browsers, then install if needed
- name: Set up Python
  uses: actions/setup-python@v4
  with:
    python-version: '3.11'

- name: Install python deps
  run: |
    python -m pip install --upgrade pip
    pip install playwright beautifulsoup4 lxml markdownify

- name: Cache Playwright browsers
  id: playwright-cache
  uses: actions/cache@v4
  with:
    path: |
      ~/.cache/ms-playwright
    # key: include runner.os and a hash of your dependency files so cache invalidates when deps change
    key: ${{ runner.os }}-playwright-${{ hashFiles('**/requirements.txt', '**/pyproject.toml', '**/poetry.lock') }}
    restore-keys: |
      ${{ runner.os }}-playwright-

# If cache miss -> install browsers + OS deps; if cache hit -> ensure system deps only
- name: Install Playwright browsers (or deps if cache hit)
  run: |
    if [ "${{ steps.playwright-cache.outputs.cache-hit }}" != 'true' ]; then
      # cache miss: install browsers + required OS dependencies
      python -m playwright install --with-deps
    else
      # cache hit: browsers present in cache, just ensure OS deps are installed
      python -m playwright install-deps || true
    fi
